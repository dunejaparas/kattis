<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.8">
<meta name="Forrest-skin-name" content="pelt">
<title>Step 3: Embedded Derby</title>
<link type="text/css" href="../../skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="../../skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="../../skin/print.css" rel="stylesheet">
<link type="text/css" href="../../skin/profile.css" rel="stylesheet">
<script src="../../skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="../../skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="../../skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="../../">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<!--+
    |breadtrail
    +-->
<div class="breadtrail">
<a href="http://www.apache.org/">apache</a> &gt; <a href="http://db.apache.org/">db</a><script src="../../skin/breadcrumbs.js" language="JavaScript" type="text/javascript"></script>
</div>
<!--+
    |header
    +-->
<div class="header">
<!--+
    |start group logo
    +-->
<div class="grouplogo">
<a href="http://db.apache.org/derby"><img class="logoImage" alt="Apache Derby" src="../../images/derby-logo-web.png" title="Derby is a zero-admin Java RDBMS"></a>
</div>
<!--+
    |end group logo
    +-->
<!--+
    |start Project Logo
    +-->
<div class="projectlogoA1">
<a href="http://db.apache.org"><img class="logoImage" alt="Apache DB Project" src="../../images/db-logo-white.png" title="Apache DB creates and maintains database solutions."></a>
</div>
<!--+
    |end Project Logo
    +-->
<!--+
    |start Tabs
    +-->
<ul id="tabs">
<li>
<a class="unselected" href="../../index.html">Home</a>
</li>
<li>
<a class="unselected" href="../../quick_start.html">Quick Start</a>
</li>
<li>
<a class="unselected" href="../../derby_downloads.html">Download</a>
</li>
<li>
<a class="unselected" href="../../derby_comm.html">Community</a>
</li>
<li>
<a class="unselected" href="../../manuals/index.html">Documentation</a>
</li>
<li class="current">
<a class="selected" href="../../blogs/index.html">Resources</a>
</li>
</ul>
<!--+
    |end Tabs
    +-->
</div>
</div>
<div id="main">
<div id="publishedStrip">
<!--+
    |start Subtabs
    +-->
<div id="level2tabs"></div>
<!--+
    |end Endtabs
    +-->
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<!--+
    |breadtrail
    +-->
<div class="breadtrail">

             &nbsp;
           </div>
<!--+
    |start Menu, mainarea
    +-->
<!--+
    |start Menu
    +-->
<div id="menu">
<div onclick="SwitchMenu('menu_1.1', '../../skin/')" id="menu_1.1Title" class="menutitle">Blogs and Articles About Derby</div>
<div id="menu_1.1" class="menuitemgroup">
<div class="menuitem">
<a href="../../blogs/index.html">Overview</a>
</div>
<div class="menuitem">
<a href="../../blogs/index.html#blogs">Blogs</a>
</div>
<div onclick="SwitchMenu('menu_1.1.3', '../../skin/')" id="menu_1.1.3Title" class="menutitle">Articles</div>
<div id="menu_1.1.3" class="menuitemgroup">
<div onclick="SwitchMenu('menu_1.1.3.1', '../../skin/')" id="menu_1.1.3.1Title" class="menutitle">Tutorials, Tips and Tuning</div>
<div id="menu_1.1.3.1" class="menuitemgroup">
<div class="menuitem">
<a href="../../blogs/index.html#getstarted">Getting Started</a>
</div>
<div class="menuitem">
<a href="../../blogs/index.html#features">Features, Hints and Tips</a>
</div>
<div class="menuitem">
<a href="../../blogs/index.html#security">Security</a>
</div>
<div class="menuitem">
<a href="../../blogs/index.html#performance">Performance and Tuning</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.3.2', '../../skin/')" id="menu_1.1.3.2Title" class="menutitle">Tools and Migration</div>
<div id="menu_1.1.3.2" class="menuitemgroup">
<div class="menuitem">
<a href="../../blogs/index.html#tools">Tools</a>
</div>
<div class="menuitem">
<a href="../../blogs/index.html#migration">Migration</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.3.3', '../../skin/')" id="menu_1.1.3.3Title" class="menutitle">Applications</div>
<div id="menu_1.1.3.3" class="menuitemgroup">
<div class="menuitem">
<a href="../../blogs/index.html#client">Client</a>
</div>
<div class="menuitem">
<a href="../../blogs/index.html#middletier">Middle Tier</a>
</div>
<div class="menuitem">
<a href="../../blogs/index.html#persistence">Persistence</a>
</div>
<div class="menuitem">
<a href="../../blogs/index.html#scalability">Scalability and Failover</a>
</div>
</div>
</div>
</div>
<div onclick="SwitchMenu('menu_1.2', '../../skin/')" id="menu_1.2Title" class="menutitle">Integration With Other Products</div>
<div id="menu_1.2" class="menuitemgroup">
<div class="menuitem">
<a href="../../integrate/index.html">Overview</a>
</div>
<div class="menuitem">
<a href="../../integrate/index.html#uses">What works with Derby?</a>
</div>
<div class="menuitem">
<a href="../../integrate/index.html#products">Product Writeups</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.3', '../../skin/')" id="menu_1.3Title" class="menutitle">Eclipse Plug-ins</div>
<div id="menu_1.3" class="menuitemgroup">
<div class="menuitem">
<a href="../../integrate/derby_plugin_info.html">Info</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.4', '../../skin/')" id="menu_selected_1.4Title" class="menutitle" style="background-image: url('../../skin/images/chapter_open.gif');">Papers and Presentations</div>
<div id="menu_selected_1.4" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="../../papers/index.html">Overview</a>
</div>
<div onclick="SwitchMenu('menu_1.4.2', '../../skin/')" id="menu_1.4.2Title" class="menutitle">Derby Engine</div>
<div id="menu_1.4.2" class="menuitemgroup">
<div onclick="SwitchMenu('menu_1.4.2.1', '../../skin/')" id="menu_1.4.2.1Title" class="menutitle">Javadoc</div>
<div id="menu_1.4.2.1" class="menuitemgroup">
<div class="menuitem">
<a href="http://db.apache.org/derby/javadoc/engine">Engine</a>
</div>
<div class="menuitem">
<a href="http://db.apache.org/derby/javadoc/language">Language</a>
</div>
<div class="menuitem">
<a href="http://db.apache.org/derby/javadoc/tools">Tools</a>
</div>
<div class="menuitem">
<a href="http://db.apache.org/derby/javadoc/publishedapi">API</a>
</div>
</div>
<div class="menuitem">
<a href="../../papers/derby_arch.html">Architecture</a>
</div>
<div class="menuitem">
<a href="../../papers/btree_package.html">BTree</a>
</div>
<div class="menuitem">
<a href="../../papers/pageformats.html">Disk Page Format</a>
</div>
<div class="menuitem">
<a href="../../papers/derby_htw.html">How Things Work</a>
</div>
<div class="menuitem">
<a href="../../papers/Intersect-design.html">Intersect &amp; Except</a>
</div>
<div class="menuitem">
<a href="../../papers/JDBCImplementation.html">JDBC</a>
</div>
<div class="menuitem">
<a href="../../papers/logformats.html">Log Format</a>
</div>
<div class="menuitem">
<a href="../../papers/recovery.html">Logging &amp; Recovery</a>
</div>
<div class="menuitem">
<a href="../../papers/optimizer.html">Optimizer</a>
</div>
<div class="menuitem">
<a href="http://db.apache.org/derby/javadoc/engine/org/apache/derby/iapi/types/package-summary.html#package_description">Type System</a>
</div>
<div class="menuitem">
<a href="../../papers/versionupgrade.html">Versioning</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.4.3', '../../skin/')" id="menu_1.4.3Title" class="menutitle">Derby Network Client</div>
<div id="menu_1.4.3" class="menuitemgroup">
<div class="menuitem">
<a href="../../papers/DerbyClientSpec.html">Functional Spec</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.4.4', '../../skin/')" id="menu_selected_1.4.4Title" class="menutitle" style="background-image: url('../../skin/images/chapter_open.gif');">Derby Tutorial</div>
<div id="menu_selected_1.4.4" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="../../papers/DerbyTut/index.html">Overview</a>
</div>
<div class="menuitem">
<a href="../../papers/DerbyTut/install_software.html">Step 1: Install Software</a>
</div>
<div class="menuitem">
<a href="../../papers/DerbyTut/ij_intro.html">Step 2: ij Basics</a>
</div>
<div class="menupage">
<div class="menupagetitle">Step 3: Embedded Derby</div>
</div>
<div class="menuitem">
<a href="../../papers/DerbyTut/ns_intro.html">Step 4: Derby Network Server</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.4.5', '../../skin/')" id="menu_1.4.5Title" class="menutitle">Presentations</div>
<div id="menu_1.4.5" class="menuitemgroup">
<div class="menuitem">
<a href="../../papers/ApacheCon.html">ApacheCon</a>
</div>
<div class="menuitem">
<a href="../../papers/MiscPresentations.html#Victorian+Java+User+Group">Victorian JUG 2008</a>
</div>
<div class="menuitem">
<a href="../../papers/MiscPresentations.html#OSCON+2005">OSCON 2005</a>
</div>
<div class="menuitem">
<a href="../../papers/MiscPresentations.html#Colorado+Software+Summit+2004">Colorado 2004</a>
</div>
</div>
</div>
<div onclick="SwitchMenu('menu_1.5', '../../skin/')" id="menu_1.5Title" class="menutitle">The Apache Software Foundation</div>
<div id="menu_1.5" class="menuitemgroup">
<div class="menuitem">
<a href="http://www.apache.org/licenses/">License</a>
</div>
<div class="menuitem">
<a href="http://www.apache.org/foundation/sponsorship.html">Donate</a>
</div>
<div class="menuitem">
<a href="http://www.apache.org/foundation/thanks.html">Thanks</a>
</div>
<div class="menuitem">
<a href="http://www.apache.org/security/">Security</a>
</div>
<div class="menuitem">
<a href="http://www.apache.org/">ASF Home</a>
</div>
</div>
<!--+
    |start Search
    +-->
<div class="searchbox">
<hr>
<form action="http://www.google.com/search" method="get">
<input value="db.apache.org" name="sitesearch" type="hidden"><input onFocus="getBlank (this, 'Search the site with google');" size="18" name="q" id="query" type="text" value="Search the site with google">&nbsp; 
                  <input name="Search" value="Search" type="submit">
</form>
</div>
<!--+
    |end search
    +-->
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="../../skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<!--+
  |alternative credits
  +-->
<div id="credit2"></div>
</div>
<!--+
    |end Menu
    +-->
<!--+
    |start content
    +-->
<div id="content">
<div class="trail">Font size: 
	          &nbsp;<input value="Reset" class="resetfont" title="Reset text" onclick="ndeSetTextSize('reset'); return false;" type="button">      
	          &nbsp;<input value="-a" class="smallerfont" title="Shrink text" onclick="ndeSetTextSize('decr'); return false;" type="button">
	          &nbsp;<input value="+a" class="biggerfont" title="Enlarge text" onclick="ndeSetTextSize('incr'); return false;" type="button">
</div>
<h1>Step 3: Embedded Derby</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#ij_intro">Introduction</a>
</li>
<li>
<a href="#embedded_setup">Set the environment</a>
</li>
<li>
<a href="#sample_app">Sample Application</a>
<ul class="minitoc">
<li>
<a href="#copy_sample_app">Copy sample application</a>
</li>
<li>
<a href="#em_lookat_code">A quick look at the code</a>
<ul class="minitoc">
<li>
<a href="#embedded_driver">Load the Embedded JDBC Driver</a>
</li>
<li>
<a href="#embedded_url">Get an Embedded Connection</a>
</li>
<li>
<a href="#shutdown">Shut Derby down</a>
</li>
</ul>
</li>
<li>
<a href="#compile_sample_app">Compile sample application</a>
</li>
<li>
<a href="#run_sample_app">Run sample application</a>
</li>
</ul>
</li>
<li>
<a href="#just_one_app">Embedded Derby supports multiple users in one JVM</a>
</li>
</ul>
</div> 


<a name="N1000D"></a><a name="ij_intro"></a>
<h2 class="boxed">Introduction</h2>
<div class="section">
<p>
When an application accesses a Derby database using the Embedded Derby JDBC
driver,
the Derby engine does not run in a separate process, and there are no
separate database processes to start up and shut down.
Instead, the Derby database engine runs inside the same
Java Virtual Machine (JVM) as the application.
So, Derby becomes part of the application 
just like any other jar file that the application uses.
Figure 1 depicts this embedded architecture.
</p>
<p>

<strong>Figure 1: Derby Embedded Architecture</strong>

</p>
<p>

<img alt="Figure 1: Embedded Architecture" src="embedded.png">
</p>
<p>
This section shows how to compile and run a simple Java application using
the Derby Embedded JDBC driver.
The information presented is deliberately simple.
For complete information, see the
<a href="http://db.apache.org/derby/manuals/">Derby Developer's Guide</a>.
</p>
</div>


<a name="N1002B"></a><a name="embedded_setup"></a>
<h2 class="boxed">Set the environment</h2>
<div class="section">
<p>
To set up the environment,
follow the 
"<a href="install_software.html#derby_configure">Configure Embedded Derby</a>"
instructions.
</p>
</div>


<a name="N10039"></a><a name="sample_app"></a>
<h2 class="boxed">Sample Application</h2>
<div class="section">
<a name="N1003F"></a><a name="copy_sample_app"></a>
<h3 class="boxed">Copy sample application</h3>
<p>
   The Derby software includes a sample application called 
   <span class="codefrag">SimpleApp.java</span>.
   In Derby 10.2 and above it is located in the
   <span class="codefrag">DERBY_INSTALL/demo/programs/simple/</span> directory.
   (In Derby 10.1 it is located in the
   <span class="codefrag">DERBY_INSTALL/demo/simple/</span> directory.)
   Copy that application into your current directory.
   </p>
<p>
   By default this application runs in embedded mode and does the following:
   </p>
<ul>
       
<li> Starts up the Derby engine</li>
       
<li> Creates and connects to a database</li>
       
<li> Creates a table</li>
       
<li> Inserts data</li>
       
<li> Updates data</li>
       
<li> Selects data</li>
       
<li> Drops a table</li>
       
<li> Disconnects</li>
       
<li> Shuts down Derby</li>
   
</ul>
<a name="N10073"></a><a name="em_lookat_code"></a>
<h3 class="boxed">A quick look at the code</h3>
<p>
   The <span class="codefrag">SimpleApp.java</span> application spends most of its time
   creating a table, inserting data into that table, and selecting the
   data back, demonstrating many JDBC calls as it does so.
   This section highlights the JDBC calls that make this specifically an
   embedded Derby application.
   The "<a href="ns_intro.html#ns_lookat_code">Derby Network Server</a>"
   section shows how the same JDBC calls turn the same code into a 
   client/server application.
   </p>
<a name="N10083"></a><a name="embedded_driver"></a>
<h4>Load the Embedded JDBC Driver</h4>
<p>
   The <span class="codefrag">SimpleApp</span> application
   loads the Derby Embedded JDBC driver and starts Derby up with this code:
   </p>
<p class="code-block">public String driver = "org.apache.derby.jdbc.EmbeddedDriver";
...
Class.forName(driver).newInstance();
</p>
<a name="N10094"></a><a name="embedded_url"></a>
<h4>Get an Embedded Connection</h4>
<p>
   The <span class="codefrag">SimpleApp</span> application
   creates and connects to the <span class="codefrag">derbyDB</span> database with this code:
   </p>
<p class="code-block">public String protocol = "jdbc:derby:";
...
conn = DriverManager.getConnection(protocol + "derbyDB;create=true", props);
</p>
<p>
   That embedded connection URL, fully constructed, looks like this:
   </p>
<p class="code-block">jdbc:derby:derbyDB;create=true</p>
<a name="N100AF"></a><a name="shutdown"></a>
<h4>Shut Derby down</h4>
<p>A clean shutdown performs a checkpoint and releases resources. 
      If an embedded application doesn't shut down Derby, 
      a checkpoint won't be performed.
      Nothing bad will happen; it just means that the next connection 
       will be slower because Derby will run its recovery code.
   </p>
<p>Code to shut down a specific database looks like this: </p>
<p class="code-block">DriverManager.getConnection("jdbc:derby:MyDbTest;shutdown=true");</p>
<p>Code to shut down all databases and the Derby engine looks like this: </p>
<p class="code-block">DriverManager.getConnection("jdbc:derby:;shutdown=true");</p>
<p>The <span class="codefrag">SimpleApp.java</span> code uses the second call to shut down
    all databases and the engine.
    You might also notice that it tests for a SQL exception.
    A clean shutdown always throws SQL exception <span class="codefrag">XJ015</span>, 
    which can be ignored.
   </p>
<a name="N100D1"></a><a name="compile_sample_app"></a>
<h3 class="boxed">Compile sample application</h3>
<p>
   Compile the sample application as shown below:
   </p>
<p class="code-block">javac SimpleApp.java</p>
<p>You can safely ignore any compile warnings that might pop up.</p>
<a name="N100E2"></a><a name="run_sample_app"></a>
<h3 class="boxed">Run sample application</h3>
<p>
   Run the sample application like this:
   </p>
<p class="code-block">java SimpleApp</p>
<p>You should see the output shown below:</p>
<p class="code-block">SimpleApp starting in embedded mode.
Loaded the appropriate driver.
Connected to and created database derbyDB
Created table derbyDB
Inserted 1956 Webster
Inserted 1910 Union
Updated 1956 Webster to 180 Grand
Updated 180 Grand to 300 Lakeshore
Verified the rows
Dropped table derbyDB
Closed result set and statement
Committed transaction and closed connection
Database shut down normally
SimpleApp finished
</p>
<p>If instead you see an error like the one below, it means the class path
   is not correctly set:
   </p>
<p class="code-block">java SimpleApp
SimpleApp starting in embedded mode.
exception thrown:
java.lang.ClassNotFoundException: org.apache.derby.jdbc.EmbeddedDriver
        at java.net.URLClassLoader$1.run(URLClassLoader.java:199)
        at java.security.AccessController.doPrivileged(Native Method)
        at java.net.URLClassLoader.findClass(URLClassLoader.java:187)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:289)
        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:274)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:235)
        at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:302)
        at java.lang.Class.forName0(Native Method)
        at java.lang.Class.forName(Class.java:141)
        at SimpleApp.go(SimpleApp.java:77)
        at SimpleApp.main(SimpleApp.java:61)
SimpleApp finished
</p>
<p>
   For help resolving class path problems, see the 
   "<a href="install_software.html#derby_configure">Configure Embedded Derby</a>"
   and
   "<a href="install_software.html#derby_verify">Verify Derby</a>"
   instructions.
   </p>
</div>


<a name="N1010A"></a><a name="just_one_app"></a>
<h2 class="boxed">Embedded Derby supports multiple users in one JVM</h2>
<div class="section">
<p>
Derby supports multiple connections to a given database.
An example of an embedded application that manages concurrent users 
is a Tomcat or Geronimo application server that embeds Derby.
Any number of users can execute Web applications that access a database
through that Web server.
</p>
<p>
However, only one JVM may boot ("open") that database, so
multiple applications running in <em>different</em> JVMs
cannot access the same database.
To understand this better, do the following.
</p>
<p>
The <span class="codefrag">SimpleApp</span> application created a database called
<span class="codefrag">derbyDB</span>. 
In one window connect to this database with
<span class="codefrag">ij</span> as shown below:
</p>
<p class="code-block">java org.apache.derby.tools.ij
ij version 10.4
ij&gt; connect 'jdbc:derby:derbyDB';
ij&gt;
</p>
</div>


<p>
Now, in another window try to run your <span class="codefrag">SimpleApp</span>
application:
</p>


<p class="code-block">java SimpleApp
SimpleApp starting in embedded mode
Loaded the appropriate driver

----- SQLException -----
  SQL State:  XJ040
  Error Code: 40000
  Message:    Failed to start database 'derbyDB', see the next exception for details.

----- SQLException -----
  SQL State:  XSDB6
  Error Code: 45000
  Message:    Another instance of Derby may have already booted the database C:\Apache\db-derby-10.4.1.3-bin\tutorial\derbyDB.
SimpleApp finished
</p>


<p>
The connection that <span class="codefrag">SimpleApp</span> tries to establish fails because
another application,
<span class="codefrag">ij</span>,
is already connected to the <span class="codefrag">derbyDB</span> database.
</p>


<p>
The problem is <span class="codefrag">ij</span> and <span class="codefrag">SimpleApp</span> are running in
different JVMs
and a given database can only be accessed from one JVM. 
The first application to connect "wins", in this case <span class="codefrag">ij</span>, and
prevents other applications from connecting.
</p>

<p>
In fact, you <em>can</em> establish multiple connections to a given database from
different JVMs.
That's the topic of the next section, 
"<a href="ns_intro.html">Step 4: Derby Network Server</a>".
</p>


</div>
<!--+
    |end content
    +-->
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<!--+
    |start bottomstrip
    +-->
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2004-2014 Apache, Apache DB, Apache Derby, Apache Torque, Apache JDO, Apache DDLUtils, the Derby hat logo, the Apache JDO logo, and the Apache feather logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners.</div>
<div id="feedback">
    Send feedback about the website to:
  <a id="feedbackto" href="mailto:derby-user@db.apache.org?subject=Feedback%C2%A0papers/DerbyTut/embedded_intro.html">derby-user@db.apache.org</a>
</div>
<!--+
    |end bottomstrip
    +-->
</div>
</body>
</html>
